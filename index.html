<!DOCTYPE html>
<html>
    <head>
        <title>Simple Map</title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #map {
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script>
            var map;
            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 37.932401 + 0.005, lng: 23.644128 + 0.005},
                    zoom: 15
                });
                //map.data.loadGeoJson('./pokemons_rawdata.json');
                loadData();
                setInterval(function () {
                    //console.log("yo");
                 loadData();   
    }, 30000);
                }
                
                function loadData() {

                    var now = new Date().getTime();

                    map.data.loadGeoJson('pokemons_rawdata.json');
                    map.data.forEach(function (feature) {
                        console.log(now + " " + feature.getProperty("disappear_time"));

                        if (feature.getProperty("disappear_time") < now) {
                            map.data.remove(feature);
                        }
                    });


                    map.data.setStyle(function (feature) {

                        return {
                            icon: {
                                url: feature.getProperty('pokemon_img'), // url
                                scaledSize: new google.maps.Size(40, 40)
                            }
                        };
                    });

                    var infowindow = new google.maps.InfoWindow();

                    // When the user clicks, open an infowindow
                    map.data.addListener('click', function (event) {
                        var name = event.feature.getProperty("pokemon_name");
                        var willdisappear = new Date(event.feature.getProperty("disappear_time")); // Epoch

                        infowindow.setContent("<div style='width:150px; text-align: center;'>" + name + "<br>" + willdisappear + "</div>");
                        infowindow.setPosition(event.feature.getGeometry().get());
                        infowindow.setOptions({pixelOffset: new google.maps.Size(0, -30)});
                        infowindow.open(map);
                    });
                
}
                


            


        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=APIKEY&callback=initMap"
        async defer></script>
    </body>
</html>
