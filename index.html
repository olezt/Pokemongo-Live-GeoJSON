<!DOCTYPE html>
<html>
    <head>

        <title>Simple Map</title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        
        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #map {
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script>
            var map;
            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: window.sw_coordlat + 0.005, 
			     lng: window.sw_coordlon + 0.005},  
                    zoom: 15,
		    streetViewControl: false
                });
var marker = new google.maps.Marker({
          position: {lat: window.botlat, lng: window.botlon},
          map: map,
          title: 'Searching for pokemon! :D'
        });

                loadData();
                //Update geoJSON every 30 sec
                setInterval(function () {
                    loadData();
                }, 10000);
		setInterval(function () {
			var botpos = new google.maps.LatLng(window.botlat, window.botlon);
       	 		marker.setPosition(botpos);
                }, 2000);
            }

            //load geoJSON
            function loadData() {
                var now = new Date().getTime();
                map.data.loadGeoJson('pokemons_rawdata.json');
                //remove expired pokemon
                map.data.forEach(function (feature) {
                    if (feature.getProperty("disappear_time") < now) {
                        map.data.remove(feature);
                    }
                    google.maps.event.removeListener(listenerHandle);
                });
		//set markers' style
                map.data.setStyle(function (feature) {
                    return {
                        icon: {
                            url: feature.getProperty('pokemon_img'), // url
                            scaledSize: new google.maps.Size(40, 40)
                        }
                    };
                });

                var infowindow = new google.maps.InfoWindow();

                // When the user clicks, open an infowindow
                listenerHandle = map.data.addListener('click', function (event) {
                    var name = event.feature.getProperty("pokemon_name");
                    var willdisappear = new Date(event.feature.getProperty("disappear_time")); // Epoch
                    infowindow.setContent("<div style='width:150px; text-align: center;'>" + name + "<br>" + willdisappear + "</div>");
                    infowindow.setPosition(event.feature.getGeometry().get());
                    infowindow.setOptions({pixelOffset: new google.maps.Size(0, -30)});
                    infowindow.open(map);
                });
            }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?callback=initMap"
        async defer></script>
<script src="coords.js"></script>
<script src="botcoords.js"></script>
    </body>
</html>
